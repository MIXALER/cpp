## 文件操作

程序运行时产生额数据都数据临时数据，程序一旦运行结束都会释放

通过**文件可以将数据持久化**

c++ 中对文件操作需要包含头文件 <fstream>



文件类型分为两种：

1.  文本文件：文件以文本的 **ASCII码** 形式存储在计算机中
2.  二进制文件：文件以**文本的二进制**形式存储在计算机中，用户一般不能直接读懂它们

操作文件的三个类：

1.  ofstream : 写操作
2.  ifstream : 读操作
3.  fstream : 读写操作



## 1 文本文件

### 1.1 写文件

写文件步骤如下：

```c++
#include <fstream>

using namespace std;

// 文本文件 写文件

void test_write()
{
    // 1. 包含头文件 fstream
    // 2. 创建流对象
    ofstream ofs;
    // 3. 指定打开方式
    ofs.open("test.txt", ios::out);
    // 4. 写内容
    ofs << "test test" << endl;
    ofs << "姓名： 张三" << endl;
    // 5.关闭流对象
    ofs.close();
}
```

文件打开方式：

| 打开方式    | 解释                       |
| ----------- | -------------------------- |
| ios::in     | 为读文件而打开文件         |
| ios::out    | 为写文件而打开文件         |
| ios::ate    | 初始位置：文件尾           |
| ios::app    | 追加方式写文件             |
| ios::trunc  | 如果文件存在先删除，再创建 |
| ios::binary | 二进制方式                 |

注意：文件打开方式可以配合使用，使用 `|` 操作符

例如：用二进制的方式写文件：`ios::binary | ios::out`

1.2 读文件

读文件与写文件步骤相似，但是读取方式相对较多

```c++
void test_write()
{
    // 1. 包含头文件 fstream
    // 2. 创建流对象
    ifstream ifs;
    // 3. 打开文件，并且判断是否打开成功,设定打开方式
    ifs.open("test.txt", ios::in);
    // 4. 读文件
    if (!ifs.is_open())
    {
        cout << "文件打开失败" << endl;
        return;
    }
//    第一种读取方式
//    char buffer[1024] = {0};
//    while (ifs >> buffer)
//    {
//        cout << buffer << endl;
//    }
//    第二种方式
//    char buffer[1024] = {0};
//    while (ifs.getline(buffer, sizeof(buffer)) )
//    {
//        cout << buffer << endl;
//    }
    //    第三种方式
    string buffer;
    while (getline(ifs, buffer))
    {
        cout << buffer << endl;
    }
    //    第四种方式
    char c;
    while ((c = ifs.get()) != EOF)
    {
        cout << c;
    }
    // 5.关闭流对象
    ifs.close();
}
```

## 2 二进制文件

打开方式指定为 `ios::binary`

### 2.1 写文件

二进制方式写文件主要利用流对象调用成员函数 `write`

函数原型： `ostream&  write(const char *buffer, int len);`

字符指针 buffer 指向内存中一段存储空间，len 是读写的字节数

```c++
class Person
{
public:
    char name_[64];
    int age_;
};

// 二进制文件 写文件
void test_write()
{
    // 1. 包含头文件 fstream
    // 2. 创建流对象
    ofstream ofs;
    // 3. 指定打开方式
    ofs.open("person.txt", ios::binary | ios::out);
    // 4. 写内容
    Person p = {"张三", 18};
    ofs.write((const char *) &p, sizeof(Person));

    // 5.关闭流对象
    ofs.close();
}
```

文件输出流对象 可以通过 write 函数，以二进制方式写数据

### 2.2 读文件

二进制方式读文件主要利用流对象调用成员函数 `read`

函数原型： `istream& read(char *buffer, int len);`

字符指针 buffer 指向内存中一段存储空间，len 是读写的字节数

```c++
class Person
{
public:
    char name_[64];
    int age_;
};

// 二进制文件 写文件
void test_write()
{
    // 1. 包含头文件 fstream
    // 2. 创建流对象
    ifstream ifs;
    // 3. 指定打开方式
    ifs.open("person.txt", ios::binary | ios::in);
    // 判断文件是否打开成功
    if (!ifs.is_open())
    {
        cout << "文件打开失败" << endl;
    }
    // 4. 读内容
    Person p;
    ifs.read((char *) &p, sizeof(Person));

    cout << p.age_ << endl;
    cout << p.name_ << endl;

    // 5.关闭流对象
    ifs.close();
}
```

